version: v2

services:
  - name: web
    type: web
    run: "gunicorn --workers 3 project.wsgi --log-file -"
  - name: default-worker
    type: worker
    run: "celery --app=project worker --queues=default --hostname=default_worker@%h --without-heartbeat --without-gossip --without-mingle --loglevel=DEBUG"
  - name: blocks-worker
    type: worker
    run: "celery --app=project worker --queues=blocks_queue --hostname=blocks_worker@%h --concurrency=1 --without-heartbeat --without-gossip --without-mingle --loglevel=DEBUG"
  - name: vbtc-worker
    type: worker
    run: "celery --app=project worker --queues=vbtc_queue --hostname=vbtc_worker@%h --concurrency=1 --without-heartbeat --without-gossip --without-mingle --loglevel=DEBUG"
  - name: runner
    type: worker
    run: "celery --app=project beat --loglevel=DEBUG"

predeploy:
  run: "python manage.py migrate"
